(()=>{"use strict";var e={607:function(e,o,t){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0});const i=r(t(860)),n=t(87),s=t(796),a=r(t(147)),l=r(t(17)),c=r(t(167)),d=(0,i.default)(),{PORT:p=3006}=process.env;d.get("/",((e,o)=>{o.send({message:"hello world"})})),d.listen(p,(()=>{console.log("server started on port:"+p)}));const u="https://api.todoinsumos.com",f=(0,n.io)("wss://socket.todoinsumos.com",{reconnectionDelayMax:1e4});f.on("print-tag-order",(e=>{const{boxes:o,name:t,phone:r,address:i,city:n,details:s}=e,c=l.default.join(__dirname,"../../cns-local/etiquetas/");a.default.writeFile(c+"envio.txt",`${o};${t};${r};${i};${n};${s}`,"latin1",(e=>{e?console.warn(e):console.log("Etiqueta pedido ",t)}))})),f.on("print-tag-product",(({codigo_pr:e,nombre_pr:o})=>{const t=l.default.join(__dirname,"../../cns-local/etiquetas/label/");a.default.writeFile(t+"label.txt",`SKU: ${e};${o}`,(e=>{e?console.warn(e):console.log("Etiqueta producto ",o)}))})),f.on("print-invoice",(e=>{const o=`F${e.pedido_id}.pdf`;(0,c.default)({url:`${u}/invoices/pdf?pedido_id=${e.pedido_id}&cliente_id=${e.cliente_id}&cbte_numero=${e.cbte_numero}`,method:"GET",responseType:"arraybuffer",headers:{authorization:e.authorization}}).then((e=>{a.default.createWriteStream(`../cns-local/pdfs/${o}`).write(Buffer.from(e.data,"utf8"),(e=>{e&&console.log(e),(0,s.print)("../cns-local/pdfs/invoice.pdf",{printer:"RICOH MP C306Z PCL 6",win32:['-print-settings "fit"']}).then((()=>{console.log("Factura impresa",o),a.default.unlinkSync(`../cns-local/pdfs/${o}`)})).catch((e=>{console.log("Error al imprimir factura",e),a.default.unlinkSync(`../cns-local/pdfs/${o}`)}))}))})).catch((e=>{console.log(e)}))})),f.on("print-order",(e=>{const o=`R${e.pedido_id}.pdf`;(0,c.default)({url:`${u}/orders/pdf`,method:"POST",responseType:"arraybuffer",headers:{authorization:e.authorization},data:{cliente_id:e.cliente_id,pedido_id:e.pedido_id}}).then((e=>{a.default.createWriteStream(`../cns-local/pdfs/${o}`).write(Buffer.from(e.data,"utf8"),(e=>{e&&console.log("error escribiendo archivo");(0,s.print)(`../cns-local/pdfs/${o}`,{printer:"RICOH MP C306Z PCL 6",win32:['-print-settings "fit"']}).then((()=>{console.log("Remito impreso",o),a.default.unlinkSync(`../cns-local/pdfs/${o}`)})).catch((e=>{console.log("Error al imprimir remito",e),a.default.unlinkSync(`../cns-local/pdfs/${o}`)}))}))})).catch((e=>{console.log("Error axios",e)}))}))},167:e=>{e.exports=require("axios")},860:e=>{e.exports=require("express")},796:e=>{e.exports=require("pdf-to-printer")},87:e=>{e.exports=require("socket.io-client")},147:e=>{e.exports=require("fs")},17:e=>{e.exports=require("path")}},o={};(function t(r){var i=o[r];if(void 0!==i)return i.exports;var n=o[r]={exports:{}};return e[r].call(n.exports,n,n.exports,t),n.exports})(607)})();